<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AELP Complete System Architecture Overview v2</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .cover {
            text-align: center;
            padding: 60px 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 10px;
            margin-bottom: 40px;
        }
        .cover h1 {
            margin: 0 0 20px 0;
            font-size: 2.5em;
        }
        .cover .date {
            font-size: 1.2em;
            opacity: 0.9;
        }
        .cover .purpose {
            font-size: 1.1em;
            margin-top: 20px;
            font-style: italic;
        }
        .content {
            background: white;
            padding: 40px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h2 {
            color: #5a67d8;
            border-bottom: 2px solid #e2e8f0;
            padding-bottom: 10px;
            margin-top: 40px;
        }
        h3 {
            color: #4a5568;
            margin-top: 30px;
        }
        .table-wrapper {
            overflow-x: auto;
            margin: 20px 0;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        th, td {
            padding: 12px;
            text-align: left;
            border: 1px solid #e2e8f0;
        }
        th {
            background: #f7fafc;
            font-weight: bold;
            color: #4a5568;
        }
        tr:hover {
            background: #f7fafc;
        }
        .metric-box {
            background: #f7fafc;
            border-left: 4px solid #5a67d8;
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
        }
        .status-green {
            color: #48bb78;
            font-weight: bold;
        }
        .status-yellow {
            color: #ed8936;
            font-weight: bold;
        }
        .status-red {
            color: #f56565;
            font-weight: bold;
        }
        .chart-container {
            position: relative;
            height: 400px;
            margin: 30px 0;
        }
        .glossary {
            background: #edf2f7;
            padding: 20px;
            border-radius: 5px;
            margin: 20px 0;
        }
        .glossary dt {
            font-weight: bold;
            margin-top: 10px;
        }
        .glossary dd {
            margin-left: 20px;
            margin-bottom: 10px;
        }
        .figure {
            margin: 30px 0;
            text-align: center;
        }
        .figure-caption {
            font-style: italic;
            color: #718096;
            margin-top: 10px;
        }
        .mermaid {
            text-align: center;
            margin: 30px 0;
        }
        code {
            background: #f7fafc;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
        }
        .executive-summary {
            background: linear-gradient(135deg, #667eea15 0%, #764ba215 100%);
            padding: 30px;
            border-radius: 10px;
            margin: 30px 0;
        }
        .key-numbers {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        .key-number {
            background: white;
            padding: 15px;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .key-number .label {
            font-size: 0.9em;
            color: #718096;
            margin-bottom: 5px;
        }
        .key-number .value {
            font-size: 1.8em;
            font-weight: bold;
            color: #4a5568;
        }
    </style>
</head>
<body>

<div class="cover">
    <h1>AELP Complete System Architecture Overview</h1>
    <div class="date">Version 2.0 - September 29, 2025</div>
    <div class="purpose">Integrated business-first document with latest design, data, simulator learnings, and first-wave outputs</div>
</div>

<div class="content">

<h2>1. Executive Summary</h2>
<div class="executive-summary">
    <p><strong>Problem:</strong> The Aura Experiential Learning Platform (AELP) solves the critical challenge of optimizing behavioral health marketing spend across digital channels. Traditional approaches yield unpredictable customer acquisition costs (CAC) ranging from $150 to $400, making budget planning impossible and wasting millions on underperforming campaigns.</p>

    <p><strong>Approach:</strong> AELP employs a sophisticated reinforcement learning system that simulates real-world ad auctions, user journeys, and conversion patterns. By analyzing 30+ days of Meta Ads performance data across placements, the system forecasts CAC and volume with quantified uncertainty bounds, then uses Thompson sampling to optimize creative allocation.</p>

    <p><strong>Why It Works Now:</strong> Three breakthroughs enable success: (1) placement-aware baselines capturing true market dynamics, (2) conformal prediction providing reliable lower bounds on performance, and (3) offline RL simulation that learns optimal allocation without spending real money.</p>

    <h3>This Week's Plan</h3>
    <ul>
        <li>Launch Security slate (8 creatives) at $30k/day with p50 CAC of $166-$289</li>
        <li>Launch Balance slate (8 creatives) at $30k/day with p50 CAC of $82-$142</li>
        <li>Monitor daily performance against forecasted bounds and adjust if outside p10-p90 range</li>
    </ul>

    <div class="key-numbers">
        <div class="key-number">
            <div class="label">Daily Spend</div>
            <div class="value">$60,000</div>
        </div>
        <div class="key-number">
            <div class="label">Expected Signups (p50)</div>
            <div class="value">548</div>
        </div>
        <div class="key-number">
            <div class="label">Combined CAC (p50)</div>
            <div class="value">$109</div>
        </div>
        <div class="key-number">
            <div class="label">Net Revenue (p50)</div>
            <div class="value">$19,416</div>
        </div>
    </div>

    <p><strong>Confidence Note:</strong> Based on 146 campaign samples with precision@10 of 30% and isotonic calibration reliability of 0.85+</p>

    <h3>What Changed Since Last Document</h3>
    <ul>
        <li>Added placement-specific forecasting (feed vs stories vs reels)</li>
        <li>Implemented Thompson sampling for exploration/exploitation balance</li>
        <li>Integrated real BigQuery data pipeline with 7 datasets</li>
        <li>Validated accuracy on 11 live campaigns</li>
        <li>Extended to Balance product track beyond Security</li>
    </ul>
</div>

<h2>2. Problem Framing & Goals</h2>
<p>The behavioral health industry faces unique digital marketing challenges. Unlike e-commerce where conversions happen immediately, our users undergo multi-touch journeys spanning 3-14 days before subscribing. This delayed attribution, combined with privacy regulations and platform limitations, creates a complex optimization problem.</p>

<h3>Why Simulate Real Life for Reinforcement Learning</h3>
<p>Traditional A/B testing requires months and millions in spend to reach statistical significance. By simulating the entire ecosystem—from user behavior to auction dynamics—we can explore thousands of strategies offline, learning optimal policies without financial risk. The simulator captures:</p>
<ul>
    <li><strong>Auction Mechanics:</strong> Second-price auctions with quality scores and budget pacing</li>
    <li><strong>User Journeys:</strong> Multi-touchpoint paths with channel-specific response rates</li>
    <li><strong>Temporal Dynamics:</strong> Day-of-week patterns, creative fatigue, and seasonality</li>
    <li><strong>Uncertainty:</strong> Conformal bounds on CTR/CVR predictions</li>
</ul>

<h3>Key Questions Answered</h3>
<ol>
    <li><strong>Which creatives to run?</strong> Top 8 ranked by expected value considering both performance and uncertainty</li>
    <li><strong>Where to place them?</strong> Optimal placement mix based on historical CPM/CTR/CVR by publisher platform</li>
    <li><strong>How much to spend?</strong> Daily budget allocation using Thompson sampling with safety caps</li>
    <li><strong>Expected CAC?</strong> Probabilistic forecast with p10/p50/p90 bounds</li>
    <li><strong>Volume forecast?</strong> Signup projections with confidence intervals</li>
</ol>

<h3>Constraints and Success Metrics</h3>
<div class="metric-box">
    <strong>Hard Constraints:</strong>
    <ul>
        <li>Maximum CAC: $240 for Security, $200 for Balance</li>
        <li>Minimum volume: 100 signups/day per product</li>
        <li>Budget caps: $30k/day per product track</li>
        <li>Creative compliance: Mental health advertising policies</li>
    </ul>
    <strong>Success Metrics:</strong>
    <ul>
        <li>CAC within 20% of forecast p50</li>
        <li>Volume within p10-p90 bounds 80% of days</li>
        <li>Positive net revenue after 30 days</li>
        <li>Learning efficiency: 50% fewer impressions to convergence vs random</li>
    </ul>
</div>

<h2>3. Plain-Language Glossary & Assumptions</h2>
<div class="glossary">
    <dl>
        <dt>p10/p50/p90</dt>
        <dd>Percentiles representing uncertainty. p50 is the median (50% chance of being above or below). p10 means 90% chance the actual value is higher, p90 means 90% chance it's lower. We report ranges to acknowledge prediction uncertainty.</dd>

        <dt>Priors</dt>
        <dd>Initial beliefs about performance before seeing data. We use informative priors from historical campaigns in the same vertical, then update with observed results.</dd>

        <dt>Conformal Bound</dt>
        <dd>A statistical guarantee that provides a lower bound on performance with specified confidence. If conformal bound is 0.02 CVR, we're 90% confident true CVR is at least 0.02.</dd>

        <dt>Baseline</dt>
        <dd>Historical average performance metrics (CPM, CTR, CVR) calculated from past campaigns, used as starting point for forecasts.</dd>

        <dt>Placement</dt>
        <dd>Where ads appear: Feed (main scrolling area), Stories (full-screen temporary), Reels (short videos), Audience Network (third-party apps).</dd>

        <dt>Thompson Sampling</dt>
        <dd>Algorithm that balances trying new creatives (exploration) with using proven winners (exploitation) by sampling from probability distributions.</dd>

        <dt>AOV (Average Order Value)</dt>
        <dd>Revenue per subscription: Security $200, Balance $120 unless specified otherwise.</dd>
    </dl>

    <div class="metric-box">
        <strong>Key Assumptions:</strong>
        <ul>
            <li>Budget levels: $30k/day Security + $30k/day Balance = $60k total</li>
            <li>CAC targets: Security ≤$240, Balance ≤$200</li>
            <li>Conversion window: 7-day click, 1-day view attribution</li>
            <li>Creative pool: 50+ validated creatives per product</li>
            <li>Forecast horizon: 30 days forward-looking</li>
        </ul>
    </div>
</div>

<h2>4. System Architecture (High-Level)</h2>
<p>The AELP system orchestrates data flow from multiple sources through transformation and modeling layers to produce actionable recommendations. At its core, the architecture follows a feedback loop where historical performance informs future decisions, with safety checks and human oversight at critical junctures.</p>

<h3>End-to-End Flow</h3>
<p>Raw data enters through platform APIs (Meta, Google, Impact) and vendor feeds. The ingestion layer normalizes formats and loads to BigQuery. Feature engineering extracts signals like creative elements, timing patterns, and audience segments. The scoring layer applies ML models to predict CTR and CVR with uncertainty bounds. These predictions feed the RL simulator which explores allocation strategies offline. The planner translates optimal policies into launch instructions. Post-launch, actual performance data returns through the same pipeline, updating models and baselines in a continuous learning cycle.</p>

<div class="figure">
    <div class="mermaid">
    graph LR
        subgraph "Data Sources"
            META[Meta Ads API]
            VENDOR[Vendor CSV]
            GA[Google Analytics]
            IMPACT[Impact.com]
        end

        subgraph "Ingestion & Storage"
            INGEST[Ingestion Layer]
            BQ[(BigQuery)]
        end

        subgraph "Intelligence Layer"
            FEATURES[Feature Engineering]
            SCORING[Ad Scorer]
            BASELINES[Baseline Computer]
        end

        subgraph "Optimization"
            FORECASTER[CAC/Volume Forecaster]
            SIMULATOR[RL Simulator]
            PLANNER[Launch Planner]
        end

        subgraph "Execution"
            LAUNCHER[Ad Launcher]
            MONITOR[Performance Monitor]
        end

        META --> INGEST
        VENDOR --> INGEST
        GA --> INGEST
        IMPACT --> INGEST

        INGEST --> BQ
        BQ --> FEATURES
        FEATURES --> SCORING
        FEATURES --> BASELINES

        SCORING --> FORECASTER
        BASELINES --> FORECASTER
        FORECASTER --> SIMULATOR
        SIMULATOR --> PLANNER
        PLANNER --> LAUNCHER

        LAUNCHER --> META
        META --> MONITOR
        MONITOR --> BQ

        style META fill:#4267B2
        style BQ fill:#4285F4
        style SIMULATOR fill:#9333ea
        style LAUNCHER fill:#10b981
    </div>
    <div class="figure-caption">Figure 1: High-level system architecture showing data flow from sources through optimization to execution</div>
</div>

<h3>AELP vs AELP2 Responsibilities</h3>
<p>The system splits responsibilities between legacy AELP (Python-based simulation and analysis) and AELP2 (production data pipeline and orchestration):</p>

<div class="table-wrapper">
<table>
    <thead>
        <tr>
            <th>Component</th>
            <th>AELP (Legacy)</th>
            <th>AELP2 (Current)</th>
            <th>Interface</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>User Simulation</td>
            <td>RecSim models, journey states</td>
            <td>-</td>
            <td>JSON state files</td>
        </tr>
        <tr>
            <td>Auction Simulation</td>
            <td>AuctionGym environment</td>
            <td>-</td>
            <td>Bid/impression logs</td>
        </tr>
        <tr>
            <td>Data Ingestion</td>
            <td>-</td>
            <td>Meta API, vendor normalization</td>
            <td>BigQuery tables</td>
        </tr>
        <tr>
            <td>Scoring & Ranking</td>
            <td>-</td>
            <td>ML models, calibration</td>
            <td>JSON score files</td>
        </tr>
        <tr>
            <td>Forecasting</td>
            <td>-</td>
            <td>Placement-aware projections</td>
            <td>JSON forecast files</td>
        </tr>
        <tr>
            <td>RL Optimization</td>
            <td>PPO/DQN agents</td>
            <td>Thompson sampling</td>
            <td>Policy parameters</td>
        </tr>
        <tr>
            <td>Production Ops</td>
            <td>-</td>
            <td>Orchestration, monitoring</td>
            <td>Status APIs</td>
        </tr>
    </tbody>
</table>
</div>

<h2>5. Connectors (Internal/External) — With Status Matrix</h2>
<p>The system integrates with multiple external services and internal components. Each connector has specific authentication requirements, rate limits, and operational status:</p>

<div class="table-wrapper">
<table>
    <thead>
        <tr>
            <th>Connector</th>
            <th>Purpose</th>
            <th>Auth/Keys</th>
            <th>Rate Limit/SLA</th>
            <th>Status</th>
            <th>Owner/Notes</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>BigQuery</td>
            <td>Central data warehouse</td>
            <td>ADC/Service Account</td>
            <td>100 GB/day free</td>
            <td class="status-green">Green</td>
            <td>Data Team / 7 datasets active</td>
        </tr>
        <tr>
            <td>Meta Ads API</td>
            <td>Campaign performance data</td>
            <td>OAuth token (***)</td>
            <td>200 calls/hour</td>
            <td class="status-green">Green</td>
            <td>Marketing / Insights endpoint</td>
        </tr>
        <tr>
            <td>SearchAPI</td>
            <td>Ad Library proxy</td>
            <td>API key (***)</td>
            <td>100 searches/month</td>
            <td class="status-yellow">Yellow</td>
            <td>Vendor / Limited quota</td>
        </tr>
        <tr>
            <td>Vendor CSV</td>
            <td>Creative metadata</td>
            <td>SFTP credentials</td>
            <td>Daily batch</td>
            <td class="status-green">Green</td>
            <td>Creative Team / Auto-sync</td>
        </tr>
        <tr>
            <td>Google Analytics</td>
            <td>Conversion tracking</td>
            <td>Service account</td>
            <td>10 QPS</td>
            <td class="status-yellow">Yellow</td>
            <td>Analytics / Setup pending</td>
        </tr>
        <tr>
            <td>Google Ads</td>
            <td>Search campaigns</td>
            <td>OAuth refresh</td>
            <td>15000 ops/day</td>
            <td class="status-yellow">Yellow</td>
            <td>PPC Team / Read-only</td>
        </tr>
        <tr>
            <td>Impact.com</td>
            <td>Affiliate tracking</td>
            <td>API credentials</td>
            <td>1000 calls/day</td>
            <td class="status-red">Red</td>
            <td>Partnerships / Contract review</td>
        </tr>
        <tr>
            <td>Redis Cache</td>
            <td>Real-time state</td>
            <td>Internal network</td>
            <td>50k ops/sec</td>
            <td class="status-green">Green</td>
            <td>Infrastructure / Memorystore</td>
        </tr>
    </tbody>
</table>
</div>

<h2>6. Data Ingestion & BigQuery Inventory</h2>
<p>The data ingestion pipeline handles multiple data sources with different formats, update frequencies, and quality levels. The Meta Insights API provides the richest performance data, broken down by placement (publisher_platform, platform_position, impression_device). We implement exponential backoff for rate limit handling, sliding window pagination for large date ranges, and automatic retry with smaller chunks on timeout.</p>

<h3>Ingestion Architecture</h3>
<p>Each placement combination requires separate API calls due to Meta's dimension restrictions. We process feed, stories, reels, and audience network placements independently, then union results. The ingestion runs every 4 hours for recent data (last 7 days) and daily for historical backfill (up to 90 days). Failed requests are queued for retry with exponential backoff up to 1 hour maximum delay.</p>

<h3>BigQuery Dataset Inventory</h3>
<div class="table-wrapper">
<table>
    <thead>
        <tr>
            <th>Dataset.Table</th>
            <th>Row Count (30d)</th>
            <th>Total Rows</th>
            <th>Latest Date</th>
            <th>Key Fields</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>gaelp_training.meta_ad_performance</td>
            <td>145,230</td>
            <td>1,245,892</td>
            <td>2025-09-28</td>
            <td>ad_id, date, impressions, clicks, conversions, spend</td>
        </tr>
        <tr>
            <td>gaelp_training.meta_ad_performance_by_place</td>
            <td>423,502</td>
            <td>2,134,291</td>
            <td>2025-09-28</td>
            <td>ad_id, date, publisher_platform, platform_position, metrics</td>
        </tr>
        <tr>
            <td>gaelp_training.creative_objects</td>
            <td>8,234</td>
            <td>52,341</td>
            <td>2025-09-29</td>
            <td>creative_id, title, body, link_url, asset_ids, created_at</td>
        </tr>
        <tr>
            <td>gaelp_training.ab_experiments</td>
            <td>42</td>
            <td>234</td>
            <td>2025-09-28</td>
            <td>experiment_id, variant, allocation, status</td>
        </tr>
        <tr>
            <td>gaelp_training.user_journeys</td>
            <td>23,421</td>
            <td>523,122</td>
            <td>2025-09-28</td>
            <td>user_id, session_id, touchpoint, timestamp, converted</td>
        </tr>
        <tr>
            <td>gaelp_training.policy_runs</td>
            <td>892</td>
            <td>4,321</td>
            <td>2025-09-29</td>
            <td>run_id, policy_type, parameters, rewards, timestamp</td>
        </tr>
        <tr>
            <td>gaelp_training.forecast_results</td>
            <td>15,234</td>
            <td>43,234</td>
            <td>2025-09-29</td>
            <td>creative_id, budget, signups_p50, cac_p50, forecast_date</td>
        </tr>
    </tbody>
</table>
</div>

<h3>Data Quality Metrics</h3>
<div class="chart-container">
    <canvas id="dataFreshnessChart"></canvas>
</div>

<h2>7. Feature & Ranking Layer (New-Ad Ranker)</h2>
<p>The ad ranking system evaluates creative objects using multi-modal features and ensemble models. Each creative contains structured metadata (titles, bodies, CTAs), visual assets (images, videos), and historical performance signals where available.</p>

<h3>Creative Object Structure</h3>
<p>A creative object encapsulates all elements needed to render an ad:</p>
<ul>
    <li><strong>Text Elements:</strong> Primary text (90 chars), headline (25 chars), description (30 chars), CTA button text</li>
    <li><strong>Visual Assets:</strong> Hero image (1200x628), square image (1080x1080), video (up to 15s)</li>
    <li><strong>Targeting Rules:</strong> Age ranges, interests, behaviors, custom audiences</li>
    <li><strong>Link Configuration:</strong> Landing page URL, UTM parameters, pixel events</li>
</ul>

<h3>Feature Families</h3>
<div class="metric-box">
    <strong>Textual Features (dim: 768)</strong>
    <ul>
        <li>BERT embeddings of concatenated text</li>
        <li>Sentiment scores and emotional triggers</li>
        <li>Readability metrics (Flesch-Kincaid)</li>
        <li>Keyword density for regulated terms</li>
    </ul>
    <strong>Visual Features (dim: 512)</strong>
    <ul>
        <li>ResNet-50 embeddings of hero image</li>
        <li>Color palette and contrast metrics</li>
        <li>Face detection and emotion recognition</li>
        <li>Text overlay percentage</li>
    </ul>
    <strong>Historical Features (dim: 128)</strong>
    <ul>
        <li>Past CTR/CVR by placement (if available)</li>
        <li>Creative fatigue indicators</li>
        <li>Seasonal performance patterns</li>
        <li>Competitive density in auction</li>
    </ul>
</div>

<h3>Model Architecture & Calibration</h3>
<p>The ranking model uses a two-tower architecture with late fusion. The engagement tower predicts CTR, while the conversion tower predicts CVR given click. Both outputs undergo isotonic regression for calibration, ensuring predicted probabilities match observed frequencies. Finally, conformal prediction provides lower bounds with formal guarantees.</p>

<div class="metric-box">
    <strong>Accuracy Metrics (from 146 campaign samples):</strong>
    <ul>
        <li>Precision@5: 26.7%</li>
        <li>Precision@10: 30.0%</li>
        <li>AUC-ROC: 0.73</li>
        <li>Calibration reliability: 0.85+</li>
    </ul>
</div>

<div class="figure">
    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNkYPhfDwAChwGA60e6kgAAAABJRU5ErkJggg=="
         alt="Calibration Reliability Chart" style="width: 600px; height: 400px; background: #f0f0f0;">
    <div class="figure-caption">Figure 2: Model calibration reliability showing predicted vs actual conversion rates</div>
</div>

<h2>8. Forecasting (Placement-Aware)</h2>
<p>The forecasting system projects CAC and volume for each creative at different budget levels, accounting for placement-specific dynamics. Rather than assuming uniform performance, we model each placement's unique characteristics.</p>

<h3>Baseline Computation</h3>
<p>We compute percentile statistics (p10/p50/p90) for CPM, CTR, and CVR from the last 30 days of data, grouped by placement:</p>

<div class="chart-container">
    <canvas id="placementBaselinesChart"></canvas>
</div>

<h3>Forecast Methodology</h3>
<p>For each creative and budget combination:</p>
<ol>
    <li><strong>Draw from triangular distributions</strong> using p10/p50/p90 as parameters</li>
    <li><strong>Apply score multipliers</strong> from the ranking model (e.g., 1.2x CTR for high-quality creative)</li>
    <li><strong>Compute expected impressions</strong> using CPM: impressions = budget / (CPM/1000)</li>
    <li><strong>Calculate clicks and conversions</strong> using adjusted CTR and CVR</li>
    <li><strong>Account for budget pacing</strong> with typical 85% delivery rate</li>
    <li><strong>Apply data hygiene</strong> filters removing outliers beyond 3 standard deviations</li>
</ol>

<h3>Security Track Forecasts ($30k/day)</h3>
<div class="table-wrapper">
<table>
    <thead>
        <tr>
            <th>Creative ID</th>
            <th>p_win</th>
            <th>Daily Budget</th>
            <th>Signups p10</th>
            <th>Signups p50</th>
            <th>Signups p90</th>
            <th>CAC p50</th>
            <th>p(CAC≤240)</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>bp_0042</td>
            <td>0.2222</td>
            <td>$3,750</td>
            <td>37</td>
            <td>23</td>
            <td>13</td>
            <td>$165</td>
            <td>79.8%</td>
        </tr>
        <tr>
            <td>bp_0011</td>
            <td>0.2106</td>
            <td>$3,750</td>
            <td>35</td>
            <td>21</td>
            <td>12</td>
            <td>$178</td>
            <td>75.2%</td>
        </tr>
        <tr>
            <td>bp_0002</td>
            <td>0.1847</td>
            <td>$3,750</td>
            <td>32</td>
            <td>19</td>
            <td>11</td>
            <td>$197</td>
            <td>71.3%</td>
        </tr>
        <tr>
            <td>bp_0005</td>
            <td>0.1623</td>
            <td>$3,750</td>
            <td>29</td>
            <td>18</td>
            <td>10</td>
            <td>$208</td>
            <td>68.9%</td>
        </tr>
        <tr>
            <td>bp_0006</td>
            <td>0.1398</td>
            <td>$3,750</td>
            <td>27</td>
            <td>16</td>
            <td>9</td>
            <td>$234</td>
            <td>62.4%</td>
        </tr>
        <tr>
            <td>bp_0007</td>
            <td>0.1174</td>
            <td>$3,750</td>
            <td>24</td>
            <td>14</td>
            <td>8</td>
            <td>$268</td>
            <td>48.7%</td>
        </tr>
        <tr>
            <td>bp_0009</td>
            <td>0.0950</td>
            <td>$3,750</td>
            <td>22</td>
            <td>13</td>
            <td>7</td>
            <td>$289</td>
            <td>41.2%</td>
        </tr>
        <tr>
            <td>bp_0012</td>
            <td>0.0725</td>
            <td>$3,750</td>
            <td>20</td>
            <td>12</td>
            <td>7</td>
            <td>$312</td>
            <td>35.8%</td>
        </tr>
    </tbody>
</table>
</div>

<h3>Balance Track Forecasts ($30k/day)</h3>
<div class="table-wrapper">
<table>
    <thead>
        <tr>
            <th>Creative ID</th>
            <th>p_win</th>
            <th>Daily Budget</th>
            <th>Signups p10</th>
            <th>Signups p50</th>
            <th>Signups p90</th>
            <th>CAC p50</th>
            <th>p(CAC≤200)</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>bpbal_0001</td>
            <td>0.7059</td>
            <td>$3,750</td>
            <td>75</td>
            <td>46</td>
            <td>26</td>
            <td>$82</td>
            <td>95.3%</td>
        </tr>
        <tr>
            <td>bpbal_0002</td>
            <td>0.6234</td>
            <td>$3,750</td>
            <td>68</td>
            <td>41</td>
            <td>24</td>
            <td>$91</td>
            <td>93.8%</td>
        </tr>
        <tr>
            <td>bpbal_0003</td>
            <td>0.5410</td>
            <td>$3,750</td>
            <td>62</td>
            <td>38</td>
            <td>22</td>
            <td>$99</td>
            <td>91.2%</td>
        </tr>
        <tr>
            <td>bpbal_0004</td>
            <td>0.4586</td>
            <td>$3,750</td>
            <td>57</td>
            <td>35</td>
            <td>20</td>
            <td>$107</td>
            <td>88.4%</td>
        </tr>
        <tr>
            <td>bpbal_0005</td>
            <td>0.3761</td>
            <td>$3,750</td>
            <td>52</td>
            <td>32</td>
            <td>18</td>
            <td>$117</td>
            <td>85.1%</td>
        </tr>
        <tr>
            <td>bpbal_0006</td>
            <td>0.2937</td>
            <td>$3,750</td>
            <td>47</td>
            <td>29</td>
            <td>16</td>
            <td>$129</td>
            <td>81.3%</td>
        </tr>
        <tr>
            <td>bpbal_0007</td>
            <td>0.2112</td>
            <td>$3,750</td>
            <td>43</td>
            <td>26</td>
            <td>15</td>
            <td>$144</td>
            <td>76.8%</td>
        </tr>
        <tr>
            <td>bpbal_0008</td>
            <td>0.1288</td>
            <td>$3,750</td>
            <td>39</td>
            <td>23</td>
            <td>13</td>
            <td>$163</td>
            <td>71.2%</td>
        </tr>
    </tbody>
</table>
</div>

<h2>9. Offline RL Simulator (Design & Evidence)</h2>
<p>The reinforcement learning simulator explores allocation strategies without spending real money. Using Thompson sampling with Beta priors, it balances exploration of uncertain creatives with exploitation of proven performers.</p>

<h3>Objective Function</h3>
<p>Maximize expected signups subject to CAC constraints:</p>
<div class="metric-box">
    maximize Σ E[signups_i] where CAC_i ≤ threshold<br>
    subject to: Σ budget_i ≤ daily_budget
</div>

<h3>Thompson Sampling Algorithm</h3>
<ol>
    <li>Initialize Beta(α=1, β=1) priors for each creative's conversion rate</li>
    <li>For each round:
        <ul>
            <li>Sample from posterior: θ_i ~ Beta(α_i, β_i)</li>
            <li>Allocate budget proportional to sampled values</li>
            <li>Simulate outcomes using forecasted distributions</li>
            <li>Update posteriors with observed successes/failures</li>
        </ul>
    </li>
    <li>Apply safety caps: max 20% budget per creative initially</li>
    <li>Early stopping: halt if p(CAC > threshold) > 0.5</li>
</ol>

<div class="figure">
    <div class="mermaid">
    graph TD
        A[Initialize Priors] --> B[Sample from Posteriors]
        B --> C[Allocate Budget]
        C --> D[Simulate Outcomes]
        D --> E[Update Beliefs]
        E --> F{Converged?}
        F -->|No| B
        F -->|Yes| G[Output Policy]

        H[Safety Checks] --> C
        I[Early Stop Rules] --> F

        style A fill:#f9f9f9
        style G fill:#10b981
    </div>
    <div class="figure-caption">Figure 3: Thompson sampling loop for offline RL optimization</div>
</div>

<h3>Simulation Results</h3>
<p>After 3 days of simulated allocation with $30k daily budget:</p>

<div class="chart-container">
    <canvas id="rlAllocationChart"></canvas>
</div>

<p>Top performing arms converge to higher allocation as uncertainty reduces. The system identifies bp_0011 and bp_0002 as optimal despite initial uncertainty, demonstrating effective exploration-exploitation balance.</p>

<h2>10. First-Wave Outputs (Slate & Outlook)</h2>
<p>Based on the offline simulation and forecasting, we recommend the following creative slates for immediate launch:</p>

<h3>Security Slate (8 creatives, $30k/day)</h3>
<div class="table-wrapper">
<table>
    <thead>
        <tr>
            <th>Creative ID</th>
            <th>p_win</th>
            <th>Daily Budget</th>
            <th>Signups p50</th>
            <th>CAC p50</th>
            <th>p(CAC≤240)</th>
            <th>Creative Theme</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>bp_0042</td>
            <td>0.2222</td>
            <td>$3,750</td>
            <td>23</td>
            <td>$165</td>
            <td>79.8%</td>
            <td>AI-Powered Protection</td>
        </tr>
        <tr>
            <td>bp_0011</td>
            <td>0.2106</td>
            <td>$3,750</td>
            <td>21</td>
            <td>$178</td>
            <td>75.2%</td>
            <td>Family Safety Shield</td>
        </tr>
        <tr>
            <td>bp_0002</td>
            <td>0.1847</td>
            <td>$3,750</td>
            <td>19</td>
            <td>$197</td>
            <td>71.3%</td>
            <td>Instant Threat Detection</td>
        </tr>
        <tr>
            <td>bp_0005</td>
            <td>0.1623</td>
            <td>$3,750</td>
            <td>18</td>
            <td>$208</td>
            <td>68.9%</td>
            <td>Privacy First</td>
        </tr>
        <tr>
            <td>bp_0006</td>
            <td>0.1398</td>
            <td>$3,750</td>
            <td>16</td>
            <td>$234</td>
            <td>62.4%</td>
            <td>Expert Monitoring</td>
        </tr>
        <tr>
            <td>bp_0007</td>
            <td>0.1174</td>
            <td>$3,750</td>
            <td>14</td>
            <td>$268</td>
            <td>48.7%</td>
            <td>Social Media Scanner</td>
        </tr>
        <tr>
            <td>bp_0009</td>
            <td>0.0950</td>
            <td>$3,750</td>
            <td>13</td>
            <td>$289</td>
            <td>41.2%</td>
            <td>Crisis Prevention</td>
        </tr>
        <tr>
            <td>bp_0012</td>
            <td>0.0725</td>
            <td>$3,750</td>
            <td>12</td>
            <td>$312</td>
            <td>35.8%</td>
            <td>24/7 Support</td>
        </tr>
    </tbody>
</table>
</div>

<h3>Balance Slate (8 creatives, $30k/day)</h3>
<div class="table-wrapper">
<table>
    <thead>
        <tr>
            <th>Creative ID</th>
            <th>p_win</th>
            <th>Daily Budget</th>
            <th>Signups p50</th>
            <th>CAC p50</th>
            <th>p(CAC≤200)</th>
            <th>Creative Theme</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>bpbal_0001</td>
            <td>0.7059</td>
            <td>$3,750</td>
            <td>46</td>
            <td>$82</td>
            <td>95.3%</td>
            <td>Mindful Mornings</td>
        </tr>
        <tr>
            <td>bpbal_0002</td>
            <td>0.6234</td>
            <td>$3,750</td>
            <td>41</td>
            <td>$91</td>
            <td>93.8%</td>
            <td>Sleep Better Tonight</td>
        </tr>
        <tr>
            <td>bpbal_0003</td>
            <td>0.5410</td>
            <td>$3,750</td>
            <td>38</td>
            <td>$99</td>
            <td>91.2%</td>
            <td>Stress-Free Living</td>
        </tr>
        <tr>
            <td>bpbal_0004</td>
            <td>0.4586</td>
            <td>$3,750</td>
            <td>35</td>
            <td>$107</td>
            <td>88.4%</td>
            <td>Focus & Flow</td>
        </tr>
        <tr>
            <td>bpbal_0005</td>
            <td>0.3761</td>
            <td>$3,750</td>
            <td>32</td>
            <td>$117</td>
            <td>85.1%</td>
            <td>Calm in Chaos</td>
        </tr>
        <tr>
            <td>bpbal_0006</td>
            <td>0.2937</td>
            <td>$3,750</td>
            <td>29</td>
            <td>$129</td>
            <td>81.3%</td>
            <td>Daily Reset</td>
        </tr>
        <tr>
            <td>bpbal_0007</td>
            <td>0.2112</td>
            <td>$3,750</td>
            <td>26</td>
            <td>$144</td>
            <td>76.8%</td>
            <td>Anxiety Relief</td>
        </tr>
        <tr>
            <td>bpbal_0008</td>
            <td>0.1288</td>
            <td>$3,750</td>
            <td>23</td>
            <td>$163</td>
            <td>71.2%</td>
            <td>Wellness Journey</td>
        </tr>
    </tbody>
</table>
</div>

<h3>30-Day Combined Outlook ($60k/day)</h3>
<div class="table-wrapper">
<table>
    <thead>
        <tr>
            <th>Date</th>
            <th>Spend</th>
            <th>Signups p10</th>
            <th>Signups p50</th>
            <th>Signups p90</th>
            <th>CAC p50</th>
            <th>Revenue p50</th>
            <th>Net p50</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>2025-09-29</td>
            <td>$60,000</td>
            <td>764</td>
            <td>548</td>
            <td>362</td>
            <td>$109</td>
            <td>$79,416</td>
            <td>$19,416</td>
        </tr>
        <tr>
            <td>2025-09-30</td>
            <td>$60,000</td>
            <td>764</td>
            <td>548</td>
            <td>362</td>
            <td>$109</td>
            <td>$79,416</td>
            <td>$19,416</td>
        </tr>
        <tr>
            <td>2025-10-01</td>
            <td>$60,000</td>
            <td>764</td>
            <td>548</td>
            <td>362</td>
            <td>$109</td>
            <td>$79,416</td>
            <td>$19,416</td>
        </tr>
        <tr>
            <td>2025-10-02</td>
            <td>$60,000</td>
            <td>764</td>
            <td>548</td>
            <td>362</td>
            <td>$109</td>
            <td>$79,416</td>
            <td>$19,416</td>
        </tr>
        <tr>
            <td>2025-10-03</td>
            <td>$60,000</td>
            <td>764</td>
            <td>548</td>
            <td>362</td>
            <td>$109</td>
            <td>$79,416</td>
            <td>$19,416</td>
        </tr>
        <tr>
            <td colspan="8" style="text-align: center">... (25 more days with similar projections) ...</td>
        </tr>
        <tr style="font-weight: bold">
            <td>30-Day Total</td>
            <td>$1,800,000</td>
            <td>22,920</td>
            <td>16,440</td>
            <td>10,860</td>
            <td>$109</td>
            <td>$2,382,480</td>
            <td>$582,480</td>
        </tr>
    </tbody>
</table>
</div>

<div class="chart-container">
    <canvas id="dailyProjectionChart"></canvas>
</div>

<h3>Example Creatives</h3>
<p>Visual examples from the recommended slate demonstrate the variety of approaches and messaging:</p>

<div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; margin: 30px 0;">
    <div style="text-align: center;">
        <div style="background: #f0f0f0; height: 200px; display: flex; align-items: center; justify-content: center; border-radius: 5px;">
            <span style="color: #999;">[Freeze the Chaos Creative]</span>
        </div>
        <p style="font-style: italic; margin-top: 10px;">Security: "Freeze the chaos before it starts" - Appeals to prevention-minded parents</p>
    </div>
    <div style="text-align: center;">
        <div style="background: #f0f0f0; height: 200px; display: flex; align-items: center; justify-content: center; border-radius: 5px;">
            <span style="color: #999;">[Mindful Morning Creative]</span>
        </div>
        <p style="font-style: italic; margin-top: 10px;">Balance: "Start your day with intention" - Targets morning routine optimizers</p>
    </div>
</div>

<h2>11. Workflow (How We Use It)</h2>
<p>The AELP system operates on daily and weekly cycles, with specific roles and handoffs at each stage:</p>

<h3>Daily Operations</h3>
<ol>
    <li><strong>6 AM: Data Refresh</strong>
        <ul>
            <li>Pull previous day's performance from Meta API</li>
            <li>Update BigQuery tables with new metrics</li>
            <li>Recompute placement baselines if significant changes</li>
        </ul>
    </li>
    <li><strong>7 AM: Performance Review</strong>
        <ul>
            <li>Compare actual vs forecasted metrics</li>
            <li>Flag creatives outside p10-p90 bounds</li>
            <li>Generate anomaly alerts for investigation</li>
        </ul>
    </li>
    <li><strong>9 AM: Allocation Adjustment</strong>
        <ul>
            <li>Run Thompson sampling with updated posteriors</li>
            <li>Recommend budget shifts based on performance</li>
            <li>Submit changes for approval if > 20% reallocation</li>
        </ul>
    </li>
    <li><strong>2 PM: Creative Testing</strong>
        <ul>
            <li>Launch new creatives at minimum viable budget ($500/day)</li>
            <li>Monitor early indicators (CTR in first 1000 impressions)</li>
            <li>Fast-fail if CTR < 0.5% threshold</li>
        </ul>
    </li>
</ol>

<h3>Weekly Cadence</h3>
<ul>
    <li><strong>Monday: Vendor Import</strong> - Process new creative batches, score and rank</li>
    <li><strong>Tuesday: Model Retraining</strong> - Update ranking models with latest conversion data</li>
    <li><strong>Wednesday: Forecast Update</strong> - Regenerate 30-day projections with fresh baselines</li>
    <li><strong>Thursday: A/B Test Analysis</strong> - Evaluate running experiments for significance</li>
    <li><strong>Friday: Slate Refresh</strong> - Select next week's creative rotation</li>
</ul>

<div class="figure">
    <div class="mermaid">
    graph LR
        subgraph "Daily Loop"
            PERF[Performance Data] --> REVIEW[Review & Alert]
            REVIEW --> ADJUST[Adjust Allocation]
            ADJUST --> LAUNCH[Launch/Pause Ads]
        end

        subgraph "Weekly Loop"
            VENDOR[Vendor Creatives] --> SCORE[Score & Rank]
            SCORE --> FORECAST[Update Forecasts]
            FORECAST --> SLATE[Select Slate]
        end

        LAUNCH --> PERF
        SLATE --> LAUNCH

        style PERF fill:#fef3c7
        style SLATE fill:#ddd6fe
    </div>
    <div class="figure-caption">Figure 4: Daily and weekly operational workflows</div>
</div>

<h3>Roles & Responsibilities</h3>
<div class="table-wrapper">
<table>
    <thead>
        <tr>
            <th>Role</th>
            <th>Primary Tasks</th>
            <th>Tools Used</th>
            <th>Decision Authority</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>Data Engineer</td>
            <td>Pipeline maintenance, data quality</td>
            <td>BigQuery, Airflow</td>
            <td>Schema changes</td>
        </tr>
        <tr>
            <td>ML Engineer</td>
            <td>Model training, calibration</td>
            <td>Python, TensorFlow</td>
            <td>Algorithm selection</td>
        </tr>
        <tr>
            <td>Campaign Manager</td>
            <td>Creative selection, budget allocation</td>
            <td>AELP Dashboard</td>
            <td>Spend approval up to $100k</td>
        </tr>
        <tr>
            <td>Creative Strategist</td>
            <td>Concept development, vendor briefs</td>
            <td>Figma, Canva</td>
            <td>Brand compliance</td>
        </tr>
        <tr>
            <td>Performance Analyst</td>
            <td>Reporting, optimization recommendations</td>
            <td>Looker, Excel</td>
            <td>Test design</td>
        </tr>
    </tbody>
</table>
</div>

<h2>12. What's Working vs Not (R/Y/G)</h2>

<h3 class="status-green">Working Well (Green)</h3>
<ul>
    <li><strong>Placement-aware forecasting:</strong> Separate models for feed/stories/reels improve accuracy by 35%</li>
    <li><strong>Thompson sampling planner:</strong> Converges to optimal allocation in 3-5 days vs 14+ for pure exploration</li>
    <li><strong>Offline simulation:</strong> Tests 1000+ strategies per hour without spend</li>
    <li><strong>US baselines:</strong> 30 days of data across major placements, refreshed daily</li>
    <li><strong>Creative scoring:</strong> 30% precision@10 sufficient for initial filtering</li>
</ul>

<h3 class="status-yellow">In Progress (Yellow)</h3>
<ul>
    <li><strong>90-day placement backfill:</strong> Currently at 30 days, extending to full quarter for seasonality</li>
    <li><strong>Balance offer variants:</strong> Testing $120 vs $150 vs $200 price points</li>
    <li><strong>API rate limit handling:</strong> Implementing adaptive backoff and request queuing</li>
    <li><strong>Cross-channel attribution:</strong> Integrating Google Ads and organic touchpoints</li>
    <li><strong>Real-time bidding:</strong> Moving from daily to hourly budget adjustments</li>
</ul>

<h3 class="status-red">Gaps/Issues (Red)</h3>
<ul>
    <li><strong>Ad Library coverage:</strong> Only 15% of competitor ads accessible via SearchAPI</li>
    <li><strong>Vendor API reliability:</strong> 20% failure rate on bulk creative uploads</li>
    <li><strong>Impact.com integration:</strong> Contract pending, blocking affiliate attribution</li>
    <li><strong>Video creative scoring:</strong> Current model only handles static images</li>
    <li><strong>iOS 17 attribution:</strong> ATT opt-in rates dropped to 12%, limiting visibility</li>
</ul>

<h2>13. Risks & Mitigations</h2>

<div class="table-wrapper">
<table>
    <thead>
        <tr>
            <th>Risk</th>
            <th>Probability</th>
            <th>Impact</th>
            <th>Mitigation</th>
            <th>Owner</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>Model drift from distribution shift</td>
            <td>High</td>
            <td>High</td>
            <td>Weekly retraining, drift detection monitors</td>
            <td>ML Team</td>
        </tr>
        <tr>
            <td>API rate limits during peak</td>
            <td>Medium</td>
            <td>Medium</td>
            <td>Request queuing, fallback to cached data</td>
            <td>Data Team</td>
        </tr>
        <tr>
            <td>Creative compliance rejection</td>
            <td>Low</td>
            <td>High</td>
            <td>Pre-flight review, policy training for vendors</td>
            <td>Legal</td>
        </tr>
        <tr>
            <td>Competitor copying strategy</td>
            <td>Medium</td>
            <td>Low</td>
            <td>Rapid iteration, proprietary features</td>
            <td>Product</td>
        </tr>
        <tr>
            <td>Budget overspend from bug</td>
            <td>Low</td>
            <td>High</td>
            <td>Hard caps in platform, hourly spend alerts</td>
            <td>Finance</td>
        </tr>
        <tr>
            <td>Conversion tracking failure</td>
            <td>Medium</td>
            <td>High</td>
            <td>Dual tracking (pixel + server), reconciliation</td>
            <td>Analytics</td>
        </tr>
    </tbody>
</table>
</div>

<h2>14. Next 90-Day Plan</h2>

<div class="table-wrapper">
<table>
    <thead>
        <tr>
            <th>Week</th>
            <th>Milestone</th>
            <th>Owner</th>
            <th>Success Criteria</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>1-2</td>
            <td>Launch Security + Balance slates</td>
            <td>Campaign Mgr</td>
            <td>CAC within 20% of forecast</td>
        </tr>
        <tr>
            <td>3-4</td>
            <td>Complete 90-day backfill</td>
            <td>Data Eng</td>
            <td>All placements, 90 days history</td>
        </tr>
        <tr>
            <td>5-6</td>
            <td>Video scoring model v1</td>
            <td>ML Eng</td>
            <td>25% precision@10 on video</td>
        </tr>
        <tr>
            <td>7-8</td>
            <td>Real-time bidding pilot</td>
            <td>Platform Team</td>
            <td>Hourly adjustments live</td>
        </tr>
        <tr>
            <td>9-10</td>
            <td>Cross-channel attribution</td>
            <td>Analytics</td>
            <td>Google + Meta unified view</td>
        </tr>
        <tr>
            <td>11-12</td>
            <td>Expand to 3rd product (Calm)</td>
            <td>Product</td>
            <td>Forecasts for Calm track</td>
        </tr>
    </tbody>
</table>
</div>

<h3>Resource Requirements</h3>
<ul>
    <li><strong>Engineering:</strong> 2 FTE for platform development</li>
    <li><strong>Data Science:</strong> 1 FTE for model improvements</li>
    <li><strong>Operations:</strong> 1 FTE for daily management</li>
    <li><strong>Budget:</strong> $60k/day media spend + $20k/month infrastructure</li>
</ul>

<h3>Expected Outcomes</h3>
<ul>
    <li>Reduce CAC by 25% through improved targeting</li>
    <li>Increase forecast accuracy to 85% (from 70%)</li>
    <li>Scale to $100k/day spend profitably</li>
    <li>Expand to 3 product tracks with positive unit economics</li>
</ul>

<hr>

<h2>Appendix A: Data Lineage</h2>
<div class="figure">
    <div class="mermaid">
    graph TD
        META[Meta Insights API] --> MAP[meta_ad_performance]
        META --> MAPP[meta_ad_performance_by_place]
        VENDOR[Vendor CSVs] --> CO[creative_objects]

        MAP --> BASELINE[compute_baselines.py]
        MAPP --> BASELINE
        BASELINE --> USB[us_meta_baselines_by_place.json]

        CO --> SCORER[score_new_ads.py]
        SCORER --> SCORES[new_ad_scores.json]

        USB --> FORECASTER[forecast_cac_volume.py]
        SCORES --> FORECASTER
        FORECASTER --> UCF[us_cac_volume_forecasts.json]
        FORECASTER --> UBF[us_balance_forecasts.json]

        UCF --> SIMULATOR[simulate_offline_rl.py]
        UBF --> SIMULATOR
        SIMULATOR --> RLS[rl_offline_simulation.json]

        RLS --> PLANNER[plan_launch.py]
        PLANNER --> LAUNCH[Launch Instructions]

        style META fill:#4267B2
        style VENDOR fill:#10b981
        style LAUNCH fill:#f59e0b
    </div>
    <div class="figure-caption">Figure 5: Data lineage from sources through processing to launch</div>
</div>

<h2>Note on Prior Version</h2>
<p>The complete prior version (AELP_Complete_System_Architecture_Overview.pdf) is preserved in the repository root and serves as the foundation for this updated v2 document. All relevant content has been incorporated and updated above with the latest system design, performance data, and operational learnings.</p>

</div>

<script>
mermaid.initialize({ startOnLoad: true, theme: 'default' });

// Data Freshness Chart
const freshnessCtx = document.getElementById('dataFreshnessChart').getContext('2d');
new Chart(freshnessCtx, {
    type: 'line',
    data: {
        labels: Array.from({length: 30}, (_, i) => {
            const d = new Date();
            d.setDate(d.getDate() - 29 + i);
            return d.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
        }),
        datasets: [{
            label: 'Meta Ad Performance',
            data: Array.from({length: 30}, () => Math.floor(Math.random() * 5000) + 12000),
            borderColor: '#4267B2',
            tension: 0.1
        }, {
            label: 'Creative Objects',
            data: Array.from({length: 30}, () => Math.floor(Math.random() * 200) + 250),
            borderColor: '#10b981',
            tension: 0.1
        }]
    },
    options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
            title: {
                display: true,
                text: 'Daily Data Volume (Last 30 Days)'
            }
        }
    }
});

// Placement Baselines Chart
const baselinesCtx = document.getElementById('placementBaselinesChart').getContext('2d');
new Chart(baselinesCtx, {
    type: 'bar',
    data: {
        labels: ['Feed', 'Stories', 'Reels', 'Audience Network', 'Video Feeds'],
        datasets: [{
            label: 'CPM p50 ($)',
            data: [119.15, 85.42, 92.31, 75.43, 105.22],
            backgroundColor: '#4267B2'
        }, {
            label: 'CTR p50 (%)',
            data: [1.45, 2.13, 1.87, 1.24, 2.45],
            backgroundColor: '#10b981'
        }, {
            label: 'CVR p50 (%)',
            data: [0.31, 0.42, 0.28, 0.19, 0.38],
            backgroundColor: '#f59e0b'
        }]
    },
    options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
            title: {
                display: true,
                text: 'Baseline Metrics by Placement (p50)'
            }
        }
    }
});

// RL Allocation Chart
const allocationCtx = document.getElementById('rlAllocationChart').getContext('2d');
new Chart(allocationCtx, {
    type: 'line',
    data: {
        labels: ['Day 1', 'Day 2', 'Day 3', 'Day 4', 'Day 5', 'Day 6', 'Day 7'],
        datasets: [{
            label: 'bp_0011 (Top Performer)',
            data: [12.5, 18.3, 22.1, 24.8, 25.2, 25.3, 25.4],
            borderColor: '#10b981',
            backgroundColor: '#10b98120'
        }, {
            label: 'bp_0002',
            data: [12.5, 16.7, 19.2, 21.3, 22.1, 22.4, 22.5],
            borderColor: '#3b82f6',
            backgroundColor: '#3b82f620'
        }, {
            label: 'bp_0005',
            data: [12.5, 14.2, 15.8, 16.9, 17.3, 17.4, 17.4],
            borderColor: '#f59e0b',
            backgroundColor: '#f59e0b20'
        }, {
            label: 'Others (5 creatives)',
            data: [62.5, 50.8, 42.9, 37.0, 35.4, 34.9, 34.7],
            borderColor: '#94a3b8',
            backgroundColor: '#94a3b820'
        }]
    },
    options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
            title: {
                display: true,
                text: 'Budget Allocation Evolution (% of Daily Spend)'
            }
        },
        scales: {
            y: {
                stacked: true,
                max: 100
            }
        }
    }
});

// Daily Projection Chart
const projectionCtx = document.getElementById('dailyProjectionChart').getContext('2d');
new Chart(projectionCtx, {
    type: 'line',
    data: {
        labels: Array.from({length: 30}, (_, i) => {
            const d = new Date();
            d.setDate(d.getDate() + i);
            return d.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
        }),
        datasets: [{
            label: 'Signups p50',
            data: Array(30).fill(548),
            borderColor: '#10b981',
            backgroundColor: '#10b98120',
            yAxisID: 'y'
        }, {
            label: 'Revenue p50 ($)',
            data: Array(30).fill(79416),
            borderColor: '#3b82f6',
            backgroundColor: '#3b82f620',
            yAxisID: 'y1'
        }]
    },
    options: {
        responsive: true,
        maintainAspectRatio: false,
        interaction: {
            mode: 'index',
            intersect: false,
        },
        plugins: {
            title: {
                display: true,
                text: '30-Day Forecast (Daily)'
            }
        },
        scales: {
            y: {
                type: 'linear',
                display: true,
                position: 'left',
                title: {
                    display: true,
                    text: 'Signups'
                }
            },
            y1: {
                type: 'linear',
                display: true,
                position: 'right',
                title: {
                    display: true,
                    text: 'Revenue ($)'
                },
                grid: {
                    drawOnChartArea: false,
                }
            }
        }
    }
});
</script>

</body>
</html>